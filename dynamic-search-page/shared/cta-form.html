// Contact Modal Functionality
document.addEventListener('DOMContentLoaded', function() {
  // Modal elements
  const contactBtn = document.getElementById('contact-btn');
  const modal = document.getElementById('contact-modal');
  const closeBtn = document.querySelector('.close-modal');
  const successPopup = document.getElementById('success-popup');
  const popupOverlay = document.getElementById('popup-overlay');
  const contactForm = document.getElementById('contact-form');

  // Open modal
  contactBtn.addEventListener('click', function() {
    modal.style.display = 'block';
    document.body.style.overflow = 'hidden';
  });

  // Close modal
  closeBtn.addEventListener('click', function() {
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
  });

  // Close when clicking outside modal
  window.addEventListener('click', function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  });

  // Location toggle buttons
  const locationButtons = document.querySelectorAll('.toggle-group .toggle-option');
  const selectedLocations = document.getElementById('selectedLocations');

  locationButtons.forEach(button => {
    button.addEventListener('click', function() {
      this.classList.toggle('selected');
      updateSelectedLocations();
    });
  });

  function updateSelectedLocations() {
    const selected = Array.from(locationButtons)
      .filter(btn => btn.classList.contains('selected'))
      .map(btn => btn.dataset.value);
    selectedLocations.value = selected.join(', ');
  }

  // Terms toggle
  const termsToggle = document.getElementById('termsToggle');
  const termsAgreed = document.getElementById('termsAgreed');

  termsToggle.addEventListener('click', function() {
    const agreed = this.getAttribute('data-agreed') === 'true';
    this.setAttribute('data-agreed', !agreed);
    this.classList.toggle('selected');
    termsAgreed.value = !agreed ? 'agreed' : '';
  });

  // Form submission
  contactForm.addEventListener('submit', function(e) {
    e.preventDefault();

    // Validate terms agreement
    if (termsAgreed.value !== 'agreed') {
      alert('Please agree to the Terms of Service');
      return;
    }

    const submitBtn = contactForm.querySelector('.submit-btn');
    const originalText = submitBtn.innerHTML;

    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';

    // Simulate form submission (replace with actual API call)
    setTimeout(() => {
      // Show success popup
      successPopup.style.display = 'block';
      popupOverlay.style.display = 'block';
      document.body.style.overflow = 'hidden';

      // Reset form
      contactForm.reset();
      locationButtons.forEach(btn => btn.classList.remove('selected'));
      selectedLocations.value = '';
      termsToggle.classList.remove('selected');
      termsToggle.setAttribute('data-agreed', 'false');
      termsAgreed.value = '';

      // Close the modal
      modal.style.display = 'none';

      // Reset button
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
    }, 1500);
  });

  // Close popup handlers
  document.getElementById('close-popup')?.addEventListener('click', () => {
    successPopup.style.display = 'none';
    popupOverlay.style.display = 'none';
    document.body.style.overflow = 'auto';
  });

  popupOverlay?.addEventListener('click', () => {
    successPopup.style.display = 'none';
    popupOverlay.style.display = 'none';
    document.body.style.overflow = 'auto';
  });
});
